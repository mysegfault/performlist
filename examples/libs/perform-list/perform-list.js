/* 
 * performlist: Performlist is an HTML5 library for making fast scrolling lists (like Contact list) 
 * v0.1.12 
 * 
 * By mysegfault <maxime.alexandre@mobile-spot.com>, https://github.com/mysegfault/performlist 
 * MIT Licence 
 * 
 */
define(["html5-mobile-boilerplate/helper","pubsub-js/pubsub","js-dom-tools/js-dom-tools"],function(a,b,c){"use strict";var d=function(){var a=this;a._options={cssPrefix:"perform-list",listContainer:"container",listContainerElement:null,listContainerParent:"container-parent",listScrollerElement:null,listScroller:"scroller",listScrollerExtraClass:"",dependsOnUlLi:!1,categoryType:"ul",titleType:"li",categoryTitleExtraClass:"",categoryItemExtraClass:"",itemType:"li",useOptimizer:!0,useFilters:!0,usePreventPageScroller:!1,autoStartAfterReady:!0,minItemsForFilters:null,end:""},a._vars={scrollingStatusId:0,optimizer:null,filter:null,preventPageScroller:null,listItems:[],itemsType:"",listElement:null,scrollerElement:null,pluginsToLoad:[],isIOS:!1,isAndroid:!1,isAndroidStockBrowser:!1,id:0,fastButtonListInst:null,iScrollInst:null,isStarted:!1,end:""}};return d.prototype.init=function(a){var c=this;if(c._vars.isIOS=null!==window.navigator.userAgent.match(/OS .+_.* like/),c._vars.isAndroid=null!==window.navigator.userAgent.match(/Android/),c._vars.isAndroidStockBrowser=null!==window.navigator.userAgent.match(/ Version\//),c._options.usePreventPageScroller=c._vars.isIOS===!0,"object"==typeof a)for(var d in a)"undefined"!=typeof c._options[d]?null!==a[d]?c._options[d]=a[d]:console.error("This option is invalid.",d,a[d]):console.error("This option does not exist.",d);return null!==c._options.listContainerElement&&"nodeName"in c._options.listContainerElement?(c._vars.listElement=c._options.listContainerElement,c._vars.listElement.classList.add(this._getClassName(c._options.listContainer))):(c._vars.listElement=document.querySelector(this._getClassName(c._options.listContainer,!0)),null!==c._vars.listElement.getAttribute("data-id")&&(c._vars.listElement=null)),null===c._vars.listElement?(console.error("Could not find main list container element.",this._getClassName(c._options.listContainer,!0)),void 0):(c._vars.listElement.parentNode.classList.add(this._getClassName(c._options.listContainerParent)),c._vars.id=""+(new Date).getTime()+Math.round(1e5*Math.random()),c._vars.listElement.setAttribute("data-id",c._vars.id),c._vars.isIOS===!0&&c._vars.listElement.classList.add("os-is-ios"),c._vars.isAndroid===!0&&c._vars.isAndroidStockBrowser===!1&&c._vars.listElement.classList.add("os-is-android"),c._vars.listElement.classList.add(c._options.cssPrefix),b.subscribe("mbs.performlist.start."+c._vars.id,function(){c._vars.isStarted!==!0&&(c.start(),c._vars.isStarted=!0)}),b.subscribe("mbs.performlist.stop."+c._vars.id,function(){c._vars.isStarted!==!1&&(c.stop(),c._vars.isStarted=!1)}),b.subscribe("mbs.performlist.ready."+c._vars.id,function(){c._options.autoStartAfterReady===!0&&b.publish("mbs.performlist.start."+c._vars.id)}),"function"==typeof window.IScroll&&"function"!=typeof window.iScroll&&(window.iScroll=window.IScroll),this._loadPlugins(),void 0)},d.prototype.getListElement=function(){var a=this;return a._vars.listElement},d.prototype.getId=function(){var a=this;return a._vars.id},d.prototype.start=function(){var a=this;if("function"==typeof window.iScroll){var b=null;"undefined"!=typeof a._vars.listElement.iScroll&&a._vars.listElement.iScroll instanceof window.iScroll&&(b=a._vars.listElement.iScroll),null!==b&&"function"==typeof $&&(b=$(a._vars.listElement).data("iscroll")),b instanceof window.iScroll&&(a._vars.iScrollInst=a._vars.listElement.iScroll=b)}null===a._vars.iScrollInst&&a._vars.listElement.classList.contains("browser-scroll")===!1&&a._vars.listElement.classList.add("browser-scroll"),a._listToListItemClick(a._vars.listElement),a._vars.scrollingStatusId=this._enableScrollingStatus(),a._vars._cb_afterListResize=function(){a._onListResize()},a._vars.listElement.addEventListener("resize",a._vars._cb_afterListResize,!1),a._startListeners()},d.prototype.stop=function(){var a=this;null!==a._vars.fastButtonListInst&&(a._vars.fastButtonListInst.destroy(a._vars.listElement),a._vars.fastButtonListInst=null),a._vars.scrollingStatusId>0&&window.clearInterval(a._vars.scrollingStatusId),a._vars.listElement.removeEventListener("resize",a._vars._cb_afterListResize,!1),a._stopListeners()},d.prototype.setData=function(a){var b=this;if(a instanceof Array)b._vars.itemsType="array",b._options.categoryType="ul",b._options.itemType="li",null!==b._vars.filter&&(b._vars.filter.destroy(),b._vars.filter=null),this._buildItemsAsArray(a);else{if(!(a instanceof Object))return console.error("Provided data is not an array not an object"),!1;b._vars.itemsType="object",b._options.dependsOnUlLi===!1&&(b._options.categoryType="dl",b._options.titleType="dt",b._options.itemType="dd"),null!==b._vars.filter&&"number"==typeof b._options.minItemsForFilters&&c.objectTotalLength(a)<b._options.minItemsForFilters&&(b._vars.filter.destroy(),b._vars.filter=null),null!==b._vars.filter&&b._vars.filter.addListSpaceForFilterElement(d),this._buildItemsAsObject(a)}if(this._buildListScroller(),null!==b._vars.optimizer?b._vars.optimizer.loadFromElement(b._vars.scrollerElement):this._buildFullListItems(),null!==b._vars.filter){var d=b._vars.listElement.querySelectorAll(this._getClassName("category-title [data-letter]",!0));b._vars.filter.setTitleElements(d)}return!0},d.prototype._getClassName=function(a,b){var c=this;if("string"!=typeof a&&""!==a)return console.error("Invalid parameter",a),"";var d=c._options.cssPrefix+"-"+a;return b===!0&&(d="."+d),d},d.prototype._buildItemsAsArray=function(a){var b=this;if(a instanceof Array==!1)return console.error("Invalid parameter",a),!1;var c=document.createElement(b._options.itemType);c.classList.add(this._getClassName("category-item"));for(var d=a.length,e=0;d>e;e++){var f=c.cloneNode();f.innerHTML=a[e],b._vars.listItems.push(f)}},d.prototype._buildItemsAsObject=function(a){var b=this;if(a instanceof Object==!1)return console.error("Invalid parameter",a),!1;var c=document.createElement(b._options.titleType);c.classList.add(this._getClassName("category-title")),""!==b._options.categoryTitleExtraClass&&c.classList.add(b._options.categoryTitleExtraClass);var d=document.createElement(b._options.itemType);d.classList.add(this._getClassName("category-item")),""!==b._options.categoryItemExtraClass&&d.classList.add(b._options.categoryItemExtraClass);for(var e in a){var f=document.createDocumentFragment(),g=c.cloneNode();null!==b._vars.filter?(g.innerHTML=b._vars.filter.createTitleHTML(e),b._vars.filter.addTitleItem(e)):g.innerHTML=e,f.appendChild(g);for(var h=0;h<a[e].length;h++){var i=d.cloneNode();i.innerHTML=a[e][h],f.appendChild(i)}b._vars.listItems.push(f)}},d.prototype._buildListScroller=function(){var a,b=this;a=null!==b._options.listScrollerElement?b._options.listScrollerElement:document.createElement(b._options.categoryType),a.classList.add(this._getClassName(b._options.listScroller)),""!==b._options.listScrollerExtraClass&&a.classList.add(b._options.listScrollerExtraClass),a.innerHTML="Building...",b._vars.listElement.innerText="",b._vars.listElement.appendChild(a),null!==b._vars.preventPageScroller&&b._vars.isIOS===!0&&b._vars.preventPageScroller.preventScrollingOnListParent(b._vars.listElement),b._vars.scrollerElement=a},d.prototype._buildFullListItems=function(){for(var a=this,c=document.createDocumentFragment(),d=a._vars.listItems.length,e=0;d>e;e++){var f=a._vars.listItems[e];c.appendChild(f)}a._vars.scrollerElement.innerHTML="",a._vars.scrollerElement.appendChild(c),b.publish("mbs.performlist.ready."+a._vars.id)},d.prototype._enableScrollingStatus=function(){function a(){c=null!==b._vars.iScrollInst?parseInt(b._vars.iScrollInst.y):b._vars.listElement.scrollTop;var a=c===d;a!==e&&(e=a,e===!0?(f>0&&(window.clearTimeout(f),f=0),f=window.setTimeout(function(){b._vars.listElement.removeAttribute("is-scrolling")},300)):b._vars.listElement.setAttribute("is-scrolling","")),d=c}var b=this;if("number"!=typeof b._vars.listElement.scrollTop)return console.error("This item is not a scrolling list"),void 0;var c=0,d=0,e=!1,f=0;return window.setInterval(a,20)},d.prototype._listToListItemClick=function(a){function d(a){if(a.type!==g)return a.preventDefault(),a.stopPropagation(),void 0;var d=c.findParentNodeWithClassName(a.target.parentNode,e._getClassName(e._options.listContainer));if(null!==d){var f=null!==d.getAttribute("is-disabled"),h=null!==d.getAttribute("is-scrolling");if(h===!0)return a.preventDefault(),a.stopPropagation(),void 0;if(f===!0)return a.preventDefault(),a.stopPropagation(),void 0}var i=c.findParentNodeWithNodeName(a.target,e._options.itemType);if(null!==i){var j={target:a.target,listItem:i};b.publish("mbs.performlist.click."+e._vars.id,j)}}var e=this,f="ontouchend"in document,g=f===!0?"touchend":"click";e._vars.fastButtonListInst=new MBP.fastButton(a,d)},d.prototype._loadPlugins=function(){var a=this,b=!0;a._vars.pluginsToLoad=[],a._vars.pluginsToLoad.filter=!1,a._vars.pluginsToLoad.optimizer=!1,a._vars.pluginsToLoad.preventPageScroller=!1,a._options.useOptimizer===!0&&(b=!1,require(["perform-list/perform-list-optimizer"],function(b){a._vars.optimizer=new b;var c={id:a._vars.id,listElement:a._vars.listElement,scrollerElement:a._vars.listScroller,listItems:a._vars.listItems};a._vars.optimizer.init(c),a._vars.pluginsToLoad.optimizer=!0,a._areAllPluginsLoaded()})),a._options.useFilters===!0&&(b=!1,require(["perform-list/perform-list-filter"],function(b){a._vars.filter=new b;var c={id:a._vars.id,listElement:a._vars.listElement};a._vars.filter.init(c),a._vars.pluginsToLoad.filter=!0,a._areAllPluginsLoaded()})),a._options.usePreventPageScroller===!0&&(b=!1,require(["perform-list/perform-list-prevent-page-scroll"],function(b){a._vars.preventPageScroller=b,a._vars.pluginsToLoad.preventPageScroller=!0,a._areAllPluginsLoaded()})),b===!0&&a._areAllPluginsLoaded()},d.prototype._areAllPluginsLoaded=function(){var a=this;a._options.useOptimizer===a._vars.pluginsToLoad.optimizer&&a._options.useFilters===a._vars.pluginsToLoad.filter&&a._options.usePreventPageScroller===a._vars.pluginsToLoad.preventPageScroller&&window.setTimeout(function(){b.publish("mbs.performlist.initialized."+a._vars.id)},0)},d.prototype._onListResize=function(){},d.prototype._startListeners=function(){var a=this,c=0,d={width:0,height:0},e=function(){if(null!==a._vars.listElement){var c=window.getComputedStyle(a._vars.listElement,null),e=!1;d.width!==c.width&&(e=!0,d.width=c.width),d.height!==c.height&&(e=!0,d.height=c.height),e===!0&&b.publish("mbs.performlist.resize."+a._vars.id)}};a._vars._cb_afterWindowResize=function(){c>0&&(window.clearTimeout(c),c=0),c=window.setTimeout(e,500)},window.addEventListener("resize",a._vars._cb_afterWindowResize,!1),a._vars._cb_afterWindowResize()},d.prototype._stopListeners=function(){var a=this;document.removeEventListener("resize",a._vars._cb_afterWindowResize,!1)},d});